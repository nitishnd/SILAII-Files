{%- comment -%}
{
  "pack_name": "Video carousel",
  "pack_author": "Design Packs",
  "license": "¬© Design Packs. All rights reserved. This code is protected by copyright law and may not be reproduced, distributed, or used without explicit permission from the author. Shopify complies with the Digital Millennium Copyright Act (DMCA) and responds to claims of copyright infringement using DMCA procedures, which could result in the termination of your Shopify account.",
}
{%- endcomment -%}

{% comment %} Security Code - hides section when app uninstalled {% endcomment %}
{%- unless content_for_header contains 'design_packs_file.js' -%}
  {%- if request.design_mode -%}
    <div class="dsgn-pck__no-app-warning">
      <div class="dsgn-pck__no-app-warning-background">
      </div>
      <div class="dsgn-pck__no-app-warning-text dsgn-pck__rte">
        <p><strong>WARNING!</strong> This premium section will not display properly without an active subscription for <a href="https://apps.shopify.com/design-packs" target="_blank" rel="noopener nofollow">Design Packs</a>. If you need any support please email <a href="mailto:info@design-packs.com" target="_blank" rel="noopener">info@design-packs.com</a> with your questions.</p>
      </div>
    </div>
  {%- endif -%}
  {%- break -%}
{%- endunless -%}

{%- comment -%} Assign: Preview section js fix {%- endcomment -%}
{%- assign section_id = section.id | replace: '+', '' | replace: '=', '' -%}

{% comment %} Blocks: check specific block types {% endcomment %}
{% assign videos = section.blocks | where: 'type', 'video' %}

{%- comment -%} Images: all placeholders {%- endcomment -%}
{%- assign background_placeholder_video_id = '5f2ab401807b458383fb168fbc4e5b03' -%}

{%- comment -%} Images: check image crop aspect ratio {%- endcomment -%}
{%- if section.settings.image_crop == 'none' -%}
  {%- assign image_crop_width = section.settings.aspect_ratio | split: ':' | first | times: 1000 -%}
  {%- assign image_crop_height = section.settings.aspect_ratio | split: ':' | last | times: 1000 -%}
{%- else -%}
  {%- assign image_crop_width = section.settings.image_crop | split: ':' | first | times: 1000 -%}
  {%- assign image_crop_height = section.settings.image_crop | split: ':' | last | times: 1000 -%}
{%- endif -%}

{% comment %} Images: responsive image widths {% endcomment %}
{%- assign widths = '180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 1950, 2100, 2260, 2450, 2700, 3000, 3350, 3750, 4100' -%}

{%- comment -%} Layout: has user entered measurement value into max-width field? {%- endcomment -%}
{%- if section.settings.max_width contains 'px' or section.settings.max_width contains '%' -%}
  {%- assign max_width = section.settings.max_width -%}
{%- else -%}
  {%- assign max_width = section.settings.max_width | append: 'px' -%}
{%- endif -%}

{%- comment -%} Text: custom font_picker values {%- endcomment -%}
{%- capture font_settings_list -%}
{{ section.settings.main_font | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'style', 'italic' | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'style', 'italic' | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'style', 'italic' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'style', 'italic' | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}
{%- endcapture -%}
{%- assign font_array = font_settings_list | split: '~' -%}

{%- capture minify -%}
{%- comment -%} CSS {%- endcomment -%}
<style>
/*! Flickity v2.2.2
https://flickity.metafizzy.co
---------------------------------------------- */
.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0;box-shadow: none;}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-button{position:absolute;background:hsla(0,0%,100%,.75);border:none;color:#333}.flickity-button:hover{background:#fff;cursor:pointer}.flickity-button:focus{outline:0;box-shadow:0 0 0 5px #19f}.flickity-button:active{opacity:.6}.flickity-button:disabled{opacity:.3;cursor:auto;pointer-events:none}.flickity-button-icon{fill:currentColor}.flickity-prev-next-button{top:50%;width:44px;height:44px;border-radius:50%;transform:translateY(-50%)}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button .flickity-button-icon{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}

{%- if section.settings.override_theme_font != blank -%}
  {%- for font in font_array -%}
    {%- unless font contains 'error' -%}var(--custom-font-check){{- font -}}{%- endunless -%}
  {%- endfor -%}
  .DP--{{ section_id }} {
    --main-font: {{ section.settings.main_font.family }}, {{ section.settings.main_font.fallback_families }};
    --main-font-weight: {{ section.settings.main_font.weight }};
    --main-font-style: {{ section.settings.main_font.style }};
    --heading-font: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
    --heading-font-weight: {{ section.settings.heading_font.weight }};
    --heading-font-style: {{ section.settings.heading_font.style }};
  }
{%- endif -%}

.DP--{{ section_id }} {
  --cell-align: "center";
  {% if section.blocks.size > 4 %}
  --wrap-around: true;
  --draggable: ">1";
  {% else %}
    --wrap-around: false;
    --draggable: false;
  {% endif %}
  --arrow-color: {{ section.settings.text_color }};
  background: {{ section.settings.background_color }};
  margin-top: {{ section.settings.outer_margin }}px;
  margin-bottom: {{ section.settings.outer_margin }}px;
  overflow-x: hidden;
}

.DP--{{ section_id }} .dsgn-pck__sizer {
  padding-top: {{ section.settings.inner_padding }}px;
  padding-bottom: {{ section.settings.inner_padding }}px;
  width: {{ section.settings.base_width }}%;
  max-width: {{ max_width }};
}

.DP--{{ section_id }} .dsgn-pck__flex--main {
  position: relative;
  align-items: center;
  grid-template-columns: repeat(auto-fill, minmax(50%, 1fr));
  grid-auto-rows: 50%;
  grid-auto-columns: minmax(0, auto);
}

.DP--{{ section_id }} .dsgn-pck__content {
  flex: 1 0 40%;
  padding: 20px;
}

.DP--{{ section_id }} .dsgn-pck__inner-content {
  width: min(400px, 80%);
  margin: auto;
}

.DP--{{ section_id }} .dsgn-pck__small-heading {
  margin: 0;
  text-align: left;
  color: {{ section.settings.text_color }};
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--heading-font);
  font-weight: var(--heading-font-weight);
  font-style: var(--heading-font-style);
  {%- endif -%}
  font-size: calc(var(--dp-g-heading-size, var(--dp-heading-size, 18px)) * 0.9);
  line-height: var(--dp-g-small-heading-line-height, var(--dp-small-heading-line-height, calc(3px + 2ex + 3px)));
}

{% comment %} Block styling {% endcomment %}
.DP--{{ section_id }} .dsgn-pck__block .dsgn-pck__small-heading {
  font-size: calc(var(--dp-g-small-heading-size, var(--dp-small-heading-size, 24px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
    font-family: var(--heading-font);
    font-weight: var(--heading-font-weight);
    font-style: var(--heading-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__rte p,
.DP--{{ section_id }} .dsgn-pck__rte ul {
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2.5ex + 3px)));
  color: {{ section.settings.text_color }};
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__block {
  color: {{ section.settings.text_color }};
}

.DP--{{ section_id }} .dsgn-pck__block + .dsgn-pck__block {
  margin-top: 15px;
}
{% comment %} End block styling {% endcomment %}

/* Slider */
.DP--{{ section_id }} .dsgn-pck__videos {
  flex: 1 0 60%;
}

.DP--{{ section_id }} .dsgn-pck__video-slider {
  margin: auto;
  overflow: visible;
}

.DP--{{ section_id }} .dsgn-pck__item {
  --slide-width: {{ section.settings.slide_width }}px;
  --final-slide-width: calc(var(--slide-width) - {{ section.settings.gap }}px);
  --slide-height: calc(var(--final-slide-width) * calc({{ image_crop_height }}/{{image_crop_width }}) - 30px);
  --selected-slide-height: calc(var(--final-slide-width) * calc({{ image_crop_height }}/{{image_crop_width }}));
  height: auto;
  width: var(--final-slide-width);
  margin: 0 {{ section.settings.gap | divided_by: 2.0 }}px;
  display: inline-block;
}

.DP--{{ section_id }} .dsgn-pck__item > a {
  text-decoration: none;
}

.DP--{{ section_id }} .dsgn-pck__stretch-height .dsgn-pck__item {
  height: 100%;
}

.DP--{{ section_id }} .is-selected .dsgn-pck__video-wrapper {
  padding-top: 0;
}

.DP--{{ section_id }} .dsgn-pck__video-inner {
    width: 100%;
}

.DP--{{ section_id }} .is-selected .dsgn-pck__hosted-video {
  width: 100%;
  min-height: var(--selected-slide-height);
  display: block;
  object-fit: cover;
}

.DP--{{ section_id }} .dsgn-pck__video {
  height: 100%;
  display: flex;
  text-align: center;
  align-items: flex-start;
  position: relative;
  overflow: hidden;
}

.DP--{{ section_id }} .dsgn-pck__video-wrapper {
  width: 100%;
  padding-top: calc(var(--selected-slide-height) - var(--slide-height));
  transition: all 0.5s ease;
  position: relative;
}

.DP--{{ section_id }} .dsgn-pck__hosted-video {
  width: 100%;
  min-height: var(--slide-height);
  display: block;
  object-fit: cover;
  border-radius: {{ section.settings.border_radius }}px;
  transition: all 0.5s ease;
}

.DP--{{ section_id }} .dsgn-pck__video-content {
  width: 100%;
  margin: 10px auto;
  display: flex;
  justify-content: center;
  gap: 15px;
  border-radius: {{ section.settings.border_radius }}px;
  border: thin solid {{ section.settings.border_color }};
  height: 100%;
  padding: 10px;
  position: relative;
  transition: all 0.2s linear;
}

.DP--{{ section_id }} .dsgn-pck__video-content:hover {
  border-width: 2px;
}

.DP--{{ section_id }} .dsgn-pck__sound-button {
  cursor: pointer;
  background-color: rgba(255, 255, 255, 0.5);
  border-radius: 50%;
  position: absolute;
  bottom: 0;
  right: 0;
  width: 35px;
  height: 35px;
  margin: 10px;
  padding: 5px;
  background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' clip-rule='evenodd'%3E%3Cpath d='M18 23l-9.305-5.998.835-.651 7.47 4.815v-10.65l1-.781v13.265zm0-15.794l5.384-4.206.616.788-23.384 18.264-.616-.788 5.46-4.264h-2.46v-10h5.691l9.309-6v6.206zm-11.26 8.794l1.26-.984v-7.016h-4v8h2.74zm10.26-8.013v-5.153l-8 5.157v6.244l8-6.248z'/%3E%3C/svg%3E");
  background-size: 65%;
  background-position: center center;
  background-repeat: no-repeat;
}

.DP--{{ section_id }} .dsgn-pck__sound-button--on {
  background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' clip-rule='evenodd'%3E%3Cpath d='M15 23l-9.309-6h-5.691v-10h5.691l9.309-6v22zm-9-15.009v8.018l8 5.157v-18.332l-8 5.157zm14.228-4.219c2.327 1.989 3.772 4.942 3.772 8.229 0 3.288-1.445 6.241-3.77 8.229l-.708-.708c2.136-1.791 3.478-4.501 3.478-7.522s-1.342-5.731-3.478-7.522l.706-.706zm-2.929 2.929c1.521 1.257 2.476 3.167 2.476 5.299 0 2.132-.955 4.042-2.476 5.299l-.706-.706c1.331-1.063 2.182-2.729 2.182-4.591 0-1.863-.851-3.529-2.184-4.593l.708-.708zm-12.299 1.299h-4v8h4v-8z'/%3E%3C/svg%3E");
}

.DP--{{ section_id }} .dsgn-pck__video-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.3);
  border-radius: {{ section.settings.border_radius }}px;
  pointer-events: none;
  z-index: 1;
}

.DP--{{ section_id }} .dsgn-pck__video-overlay-text {
  color: #ffffff;
  text-align: center;
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2.5ex + 3px)));
  padding: 10px 15px;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  max-width: 90%;
}

.DP--{{ section_id }} .dsgn-pck__text-area {
  flex: 1;
  text-align: {{ section.settings.text_alignment }};
  display: flex;
  width: 100%;
  align-items: center;
  justify-content: {{ section.settings.text_alignment }};
}

.DP--{{ section_id }} .dsgn-pck__videos-nav {
  width: fit-content;
  margin: 0 auto;
  display: flex;
  gap: 20px;
  margin-top: 20px;
}

.DP--{{ section_id }} .dsgn-pck__nav-button {
  cursor: pointer;
}

.DP--{{ section_id }} .dsgn-pck__rte p,
.DP--{{ section_id }} .dsgn-pck__rte ul {
  color: {{ section.settings.text_color }};
}

.DP--{{ section_id }} .dsgn-pck__small-heading {
  color: {{ section.settings.text_color }};
}

.DP--{{ section_id }} .dsgn-pck__image {
  width: 25%;
  overflow: hidden;
  border-radius: {{ section.settings.border_radius }}px;
}

.DP--{{ section_id }} .dsgn-pck__videos-wrapper:after {
  content: 'flickity';
  display: none;
}

.DP--{{ section_id }} .dsgn-pck__videos-wrapper:not(.flickity-enabled) {
  display: flex;
  gap: 10px;
}

.DP--{{ section_id }} .dsgn-pck__videos-wrapper:not(.flickity-enabled) .dsgn-pck__item:nth-child(n+{{ section.settings.per_row | plus: 1 }}){
  display: none;
}

.DP--{{ section_id }} .flickity-slider {
  top: 0;
}

.DP--{{ section_id }} .flickity-enabled {
  position: relative;
}

/* Play buttons */
.DP--{{ section_id }} .dsgn-pck__video-wrapper {
  --play-button-size: 50px;
  position: relative;
}

.DP--{{ section_id }} .dsgn-pck__play-button-wrapper {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.DP--{{ section_id }} .dsgn-pck__item.is-selected svg.dsgn-pck__play-button {
  transition: opacity 0.3s ease-in-out;
  opacity: 0;
}

.DP--{{ section_id }} svg.dsgn-pck__play-button,
.DP--{{ section_id }} svg.dsgn-pck__pause-button {
  transition: opacity 0.3s ease-in-out;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: var(--play-button-size);
  height: var(--play-button-size);
  fill: {{ section.settings.play_button_color }};
  transition: 0.1s ease;
  cursor: pointer;
  pointer-events: all;
}

.DP--{{ section_id }} svg.dsgn-pck__pause-button {
  opacity: 0;
  transition: 0.1s ease;
  width: calc(var(--play-button-size)/1.5);
  height: calc(var(--play-button-size)/1.5);
  fill: {{ section.settings.play_button_color }};
}

.DP--{{ section_id }} .dsgn-pck__playing svg.dsgn-pck__play-button {
  opacity: 0;
}

.DP--{{ section_id }} .dsgn-pck__video-wrapper:hover .dsgn-pck__playing svg.dsgn-pck__pause-button {
  opacity: 100;
  pointer-events: initial;
  animation: fadeOutAnimation 1.5s cubic-bezier(0.4, 0, 1, 1);
  animation-iteration-count: 1;
  animation-fill-mode: forwards;
}

@keyframes fadeOutAnimation {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

{%- if section.settings.custom_css != blank -%}
  {%- assign custom_section_declarations = section.settings.custom_css | split: '}' -%}
  {%- for declaration in custom_section_declarations -%}
    {%- if declaration contains '{' -%}
      #DP--{{ section_id }} {{ declaration }} }
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

/* Landscape phones and down */
@media (max-width: 480px) {
  .DP--{{ section_id }} {
    margin-top: {{ section.settings.outer_margin | divided_by: 2 }}px;
    margin-bottom: {{ section.settings.outer_margin | divided_by: 2 }}px;
    --draggable: ">1";
    --wrap-around: true;
  }

  .DP--{{ section_id }} .dsgn-pck__sizer {
    margin: 0 auto;
    padding-top: {{ section.settings.inner_padding | divided_by: 2 }}px;
    padding-bottom: {{ section.settings.inner_padding | divided_by: 2 }}px;
  }

  .DP--{{ section_id }} .dsgn-pck__item {
    --slide-width: 300px;
  }

  {%- if section.settings.mobile_custom_css != blank -%}
    {%- assign mobile_custom_declarations = section.settings.mobile_custom_css | split: '}' -%}
    {%- for declaration in mobile_custom_declarations -%}
      {%- if declaration contains '{' -%}
        #DP--{{ section_id }} {{ declaration }} }
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}

}
</style>

{%- liquid
  if videos.size == 0
    break
  endif
-%}

{%- comment -%} HTML {%- endcomment -%}
<section id="DP--{{ section_id }}" class="DP--{{ section_id }} dsgn-pck__videos-slider dsgn-pck__section">
  {%- if section.settings.anchor_id != blank -%}
    <div id="{{ section.settings.anchor_id | remove: '#' | handleize }}" class="dsgn-pck__anchor-id" style="height: 0; overflow: hidden;"></div>
  {%- endif -%}
  <div class="dsgn-pck__sizer">
    <div class="dsgn-pck__flex dsgn-pck__flex--main">
      <div class="dsgn-pck__videos">
        <div id="slider-{{ section_id }}" class="dsgn-pck__videos-wrapper dsgn-pck__video-slider">
          {%- assign visible_blocks = videos.size -%}
          {%- for block in videos -%}
            {% comment %} Metafields: hide block if there is no content {% endcomment %}
            {%- liquid
              if section.settings.enable_metafield_detect == true
                # Check if the block has any of the required fields populated
                capture block_fields_list
                  echo "html5_video"
                endcapture
                assign block_fields = block_fields_list | split: ','
                assign blank_fields = 0
                # Loop through the fields and check if they are blank
                for id in block_fields
                  if block.settings[id] == blank
                    assign blank_fields = blank_fields | plus: 1
                  endif
                endfor
                if block_fields.size == blank_fields
                  # If all required fields are blank, then hide the block and subtract from visible columns count
                  assign visible_blocks = visible_blocks | minus: 1
                  continue
                endif
              endif
            -%}
            <div class="dsgn-pck__item dsgn-pck__item dsgn-pck__video-{{ forloop.index }} dsgn-pck__block-id-{{ block.id }}" {{ block.shopify_attributes }}>
              <div class="dsgn-pck__video">
                <div class="dsgn-pck__video-inner">
                  {%- if block.settings.html5_video != blank -%}
                    <div class="dsgn-pck__video-wrapper">
                      {%- assign video = block.settings.html5_video -%}
                      <video class="dsgn-pck__hosted-video dsgn-pck__video-element" width="{{ video.aspect_ratio | times: 100 }}" height="100" playsinline loop muted loading="lazy" poster="{{ video.preview_image | image_url: width: 800 }}">
                        {%- for source in video.sources -%}
                          {%- if source.format == 'mp4' or source.format == 'mov' -%}<source data-src="{{ source.url }}">{%- endif -%}
                        {%- endfor -%}
                      </video>
                      {%- if block.settings.overlay_text != blank -%}
                        <div class="dsgn-pck__video-overlay">
                          <div class="dsgn-pck__video-overlay-text">{{ block.settings.overlay_text }}</div>
                        </div>
                      {%- endif -%}
                      <div class="dsgn-pck__sound-button"></div>
                      <div class="dsgn-pck__play-button-wrapper" data-play-trigger>
                        <svg id="dsgn-pck__play-button" class="dsgn-pck__play-button" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3 17v-10l9 5.146-9 4.854z"/></svg>
                        <svg id="dsgn-pck__pause-button" class="dsgn-pck__pause-button" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 22h-4v-20h4v20zm6-20h-4v20h4v-20z"/></svg>
                      </div>
                    </div>
                  {%- else -%}
                  {% comment %} Placeholder {% endcomment %}
                  <div class="dsgn-pck__video-wrapper">
                    <video
                      class="dsgn-pck__hosted-video dsgn-pck__video-element"
                      width="2000" height="100"
                      playsinline loop muted loading="lazy">
                        <source data-src="https://cdn.shopify.com/videos/c/o/v/{{ background_placeholder_video_id }}.mp4" data-dsgn-pck-default-src>
                    </video>
                    {%- if block.settings.overlay_text != blank -%}
                      <div class="dsgn-pck__video-overlay">
                        <div class="dsgn-pck__video-overlay-text">{{ block.settings.overlay_text }}</div>
                      </div>
                    {%- endif -%}
                    <div class="dsgn-pck__sound-button"></div>
                    <div class="dsgn-pck__play-button-wrapper" data-play-trigger>
                      <svg id="dsgn-pck__play-button" class="dsgn-pck__play-button" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3 17v-10l9 5.146-9 4.854z"/></svg>
                      <svg id="dsgn-pck__pause-button" class="dsgn-pck__pause-button" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 22h-4v-20h4v20zm6-20h-4v20h4v-20z"/></svg>
                    </div>
                  </div>
                  {%- endif -%}
                  {%- unless block.settings.product == blank and block.settings.collection == blank -%}
                    {%- assign collection = collections[block.settings.collection] -%}
                    <div class="dsgn-pck__video-content">
                      <a href="{{ block.settings.product.url | default: collection.url }}" class="dsgn-pck__absolute-link"></a>
                      {%- if block.settings.product.featured_image != blank or block.settings.collection.featured_image != blank -%}
                        {%- assign image = block.settings.product.featured_image | default: collection.featured_image -%}
                        {%- comment -%} Crop based on initial image width and height{%- endcomment -%}
                        {%- if section.settings.image_crop == 'none' -%}
                          {%- assign image_crop_width = image.width -%}
                          {%- assign image_crop_height = image.height -%}
                        {%- endif -%}
                        {%- if image != blank -%}
                          <div class="dsgn-pck__image dsgn-pck__image--{{ section.settings.image_crop }}">
                            <div class="dsgn-pck__image__wrapper">
                              <svg class="dsgn-pck__svg-sizer" viewBox="0 0 {{ image_crop_width | default: 1000 }} {{ image_crop_height | default: 1000 }}"></svg>
                              {%- capture sizes -%}
                                (max-width: 480px) {{ section.settings.base_width | append: 'vw' | default: '90vw' }}, {{ section.settings.base_width | divided_by: section.settings.per_row | divided_by: 2 | append: 'vw' | default: '33vw' }}
                              {%- endcapture -%}
                              {{ image | image_url: width: 1000 | image_tag:  widths: widths, sizes: sizes }}
                            </div>
                          </div>
                        {%- endif -%}
                      {%- endif -%}
                      <div class="dsgn-pck__text-area">
                        <div class="dsgn-pck__text dsgn-pck__rte">
                          <p>{{ block.settings.product.title | default: collection.title }}</p>
                        </div>
                      </div>
                    </div>
                  {%- endunless -%}
                </div>
              </div>
            </div>
          {%- endfor -%}
          {%- if visible_blocks == 0 and section.settings.enable_metafield_detect == true -%}
            <style>
              .DP--{{ section_id }} {
                display: none;
              }
            </style>
          {%- endif -%}
        </div>
        {%- if section.settings.show_arrows != blank -%}
          <div class="dsgn-pck__videos-nav">
            <div class="dsgn-pck__nav-button dsgn-pck__nav-button--prev">
              <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm3 5.753l-6.44 5.247 6.44 5.263-.678.737-7.322-6 7.335-6 .665.753z" fill="{{ section.settings.border_color }}"/></svg>
            </div>
            <div class="dsgn-pck__nav-button dsgn-pck__nav-button--next">
              <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm-3 5.753l6.44 5.247-6.44 5.263.678.737 7.322-6-7.335-6-.665.753z" fill="{{ section.settings.border_color }}"/></svg>
            </div>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>
{%- endcapture -%}
{{ minify | strip_newlines }}

{% schema %}
{
  "name": "Video carousel",
  "class": "DP__video-carousel",
  "settings": [
    {
      "type": "range",
      "id": "slide_width",
      "label": "Slide width",
      "min": 300,
      "max": 500,
      "step": 5,
      "default": 300,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "image_crop",
      "label": "Video aspect ratio",
      "default": "none",
      "options": [
        {
          "value": "16:9",
          "label": "Cinema (16:9)"
        },
        {
          "value": "4:3",
          "label": "Landscape (4:3)"
        },
        {
          "value": "2:3",
          "label": "Portrait (2:3)"
        },
        {
          "value": "1:1",
          "label": "Square (1:1)"
        },
        {
          "value": "none",
          "label": "Custom aspect ratio (see below)"
        }
      ]
    },
    {
      "type": "text",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "9:16",
      "info": "Will only be applied if 'Custom aspect ratio' is selected as banner height. eg. '9:16' or '3:2'"
    },
    {
      "type": "range",
      "id": "autoplay",
      "label": "Change slide every",
      "min": 0,
      "max": 12,
      "step": 1,
      "default": 8,
      "unit": "sec",
      "info": "Set to '0' to disable autoplay"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 40,
      "label": "Spacing gap",
      "unit": "px",
      "default": 10
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_play_buttons",
      "label": "Show play buttons",
      "default": false
    },
    {
      "visible_if": "{{ section.settings.show_play_buttons }}",
      "type": "color",
      "id": "play_button_color",
      "label": "Play buttons",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "‚úèÔ∏è Text appearance"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 60,
      "max": 120,
      "step": 5,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ]
    },
    {
      "type": "header",
      "content": "üé® Design"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border",
      "default": "#121212"
    },
    {
      "type": "color_background",
      "id": "background_color",
      "label": "Background"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Rounded corners",
      "min": 0,
      "max": 30,
      "step": 1,
      "default": 10,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "üñº Layout"
    },
    {
      "type": "range",
      "id": "base_width",
      "label": "Size",
      "min": 80,
      "max": 100,
      "step": 5,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Maximum width",
      "placeholder": "eg. 1200px",
      "info": "Sets width constraint for content."
    },
    {
      "type": "range",
      "id": "inner_padding",
      "label": "Inner padding",
      "info": "Only applies to top and bottom.",
      "min": 0,
      "max": 100,
      "default": 40,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "outer_margin",
      "label": "Outer margin",
      "info": "Only applies to top and bottom.",
      "min": 0,
      "max": 100,
      "default": 0,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "üö® Advanced"
    },
    {
      "type": "liquid",
      "id": "custom_css",
      "label": "CSS"
    },
    {
      "type": "liquid",
      "id": "mobile_custom_css",
      "label": "Mobile CSS",
      "info": "Applied on screens less than 480px."
    },
    {
      "type": "text",
      "id": "anchor_id",
      "label": "Link anchor id",
      "placeholder": "#design-pack-section",
      "info": "Enter a unique value to jump to this section from same page using a link or button. Eg. #design-pack-section [Learn more](https://app.gitbook.com/o/UwqKbTxsdQExehd4SSPM/s/iJpf70jLagzGk8zoz4fu/fundamentals/how-to-guides/how-to-jump-link-to-another-section-on-the-same-page)"
    },
    {
      "type": "checkbox",
      "id": "override_theme_font",
      "label": "Override default theme font",
      "default": false
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading",
      "default": "serif"
    },
    {
      "type": "font_picker",
      "id": "main_font",
      "label": "Text",
      "default": "sans-serif"
    },
    {
      "type": "checkbox",
      "id": "enable_metafield_detect",
      "label": "Enable metafield detection",
      "default": false,
      "info": "Hide section if content is not detected. [Learn more](https://design-packs.gitbook.io/docs/fundamentals/settings/enable-metafield-detection-setting)"
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "video",
          "id": "html5_video",
          "label": "Hosted video"
        },
        {
          "type": "text",
          "id": "overlay_text",
          "label": "Overlay text",
          "info": "Text to display on top of the video"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video carousel üéí",
      "blocks": [
        {
          "type": "video"
        },
        {
          "type": "video"
        },
        {
          "type": "video"
        },
        {
          "type": "video"
        },
        {
          "type": "video"
        }
      ]
    }
  ]
}
{% endschema %}
{%- comment -%} JSON Settings {%- endcomment -%}
<script type="application/json" data-dsgn-pck="{{ section_id }}">
  {
    "id": {{ section_id | json }},
    "autoplay": {{ section.settings.autoplay | times: 1000 | json }}
  }
</script>

{%- comment -%} External scripts {%- endcomment -%}
<script data-dsgn-pck-external-js="{{ section_id }}" src="https://cdn.shopify.com/s/files/1/0577/7673/4361/files/flickity-2.3.0.pkgd.min.js?v=1671485005" defer></script>
{%- comment -%} JavaScript {%- endcomment -%}
<script data-dsgn-pck-js="{{ section_id }}" type="module" defer>
(function(){

  const designPack = {
    settings: {},
    onIntersect: function(entries, observer){
      // Target the first entry available.
      let observedSection = entries[0];
      if (!observedSection.isIntersecting) return;
      const section = observedSection.target;

      /* Run these functions when section is visible */
      designPack.initializeSlider(section);
      designPack.animateSection(section);

      /* Stop observing section */
      observer.unobserve(section);
    },
    animateSection: function(section){
      section.classList.add('dsgn-pck__animation-applied');
    },
    initializeSlider: function(section) {
      const elem = section.querySelector(`#slider-${designPack.settings.id}`);
      if (!elem) return;

      designPack.flkty = new Flickity(elem, {
        cellAlign: JSON.parse(getComputedStyle(section).getPropertyValue('--cell-align')),
        autoPlay: this.settings.autoplay,
        draggable: JSON.parse(getComputedStyle(section).getPropertyValue('--draggable')),
        contain: true,
        wrapAround: JSON.parse(getComputedStyle(section).getPropertyValue('--wrap-around')),
        adaptiveHeight: false,
        watchCSS: false,
        imagesLoaded: true,
        prevNextButtons: false,
        pageDots: false,
        on: {
          staticClick: function( event, pointer, cellElement, cellIndex ) {
            if ( typeof cellIndex == 'number' ) {
              this.selectCell( cellIndex );
              const videos = section.querySelectorAll('video');
              if (videos.length) {
                videos.forEach(video => video.pause());
                videos[cellIndex].play();
                const activeCheck = videos[cellIndex].parentNode.querySelector('.dsgn-pck__sound-button').classList.contains('dsgn-pck__sound-button--on');
                if (activeCheck) {
                  videos[cellIndex].muted = false;
                }
              }
            }
          },
          change: function() {
            const cellIndex = this.selectedIndex;
            designPack.enableLazyVideoAutoplay(section);
            const videos = section.querySelectorAll('.dsgn-pck__video-element');
            if (videos.length) {
              videos.forEach((video, idx) => {
                if (idx === cellIndex) {
                  video.play();
                } else {
                  video.pause();
                }
              });
              const activeCheck = videos[cellIndex].parentNode.querySelector('.dsgn-pck__sound-button').classList.contains('dsgn-pck__sound-button--on');
              if (activeCheck) {
                videos[cellIndex].muted = false;
              }
            }
          },
          ready: () => {
            setTimeout(() => {
              elem.classList.add('dsgn-pck__stretch-height');
              designPack.enableLazyVideoAutoplay(section);
              const videos = section.querySelectorAll('.dsgn-pck__video-element');
              if (videos.length) {
                videos.forEach((video, idx) => {
                  if (idx === 0) {
                    video.play();
                  } else {
                    video.pause();
                  }
                });
              }
            }, 500);
          }
        }
      });

      var previousButton = section.querySelector('.dsgn-pck__nav-button--prev');
      if (typeof previousButton != 'undefined' && previousButton != null) {
        previousButton.addEventListener( 'click', function() {
          designPack.flkty.previous();
        });
      }

      var nextButton = section.querySelector('.dsgn-pck__nav-button--next');
      if (typeof nextButton != 'undefined' && nextButton != null) {
        nextButton.addEventListener( 'click', function() {
          designPack.flkty.next();
        });
      }

      var soundButtons = section.querySelectorAll('.dsgn-pck__sound-button');
      if (typeof soundButtons != 'undefined' && soundButtons != null) {
        soundButtons.forEach((button, index) => {
          button.addEventListener('click', function() {
            const videos = section.querySelectorAll('video');
            if (videos.length) {
              videos.forEach(video => video.muted = true);
              const selectedVideo = videos[designPack.flkty.selectedIndex];

              if (button.classList.contains('dsgn-pck__sound-button--on')) {
                // Unmute video
                selectedVideo.muted = true;
              } else {
                // Mute video
                selectedVideo.muted = false;
              }

              soundButtons.forEach(button => button.classList.toggle('dsgn-pck__sound-button--on'));
            }
            return false;
          });
        });
      }
    },
    enableLazyVideoAutoplay: function(section) {
      // Get video source urls
      const lazySources = section.querySelectorAll('.dsgn-pck__video-element source[data-src]');
      lazySources.forEach(source => {
        if (!source.src) {
          source.src = source.dataset.src;
          // Only call load() on the parent video if we just set src
          const video = source.closest('video');
          if (video) video.load();
        }
      });
    },
    load: function(section){

      const options = {
        root: null,
        rootMargin: '0px',
        threshold: [0, 0.25, 0.5, 0.75, 1]
      };
      // Trigger functions when section is visible
      const observer = new IntersectionObserver( designPack.onIntersect, options );
      if (section) {
        observer.observe(section);
      }

    },
    unload: function(section){
    }
  }

  window.addEventListener('shopify:section:unload', function (e) {
    const settings = document.querySelector(`[data-dsgn-pck="${e.detail.sectionId}"]`);
    const sectionId = e.detail.sectionId;
    const section = document.querySelector(`#DP--${e.detail.sectionId}`);
    if (sectionId == designPack.settings.id){
      designPack.unload(section);
    }
  });

  designPack.settings = JSON.parse(document.querySelector('[data-dsgn-pck="{{ section_id }}"]').innerHTML);
  const sectionId = {{ section_id | json }};
  const section = document.querySelector(`#DP--${sectionId}`);

  if (sectionId == designPack.settings.id){
    designPack.load(section);
  }
})()
</script>
