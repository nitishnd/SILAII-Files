{%- comment -%}
{
  "pack_name": "Article comments",
  "pack_author": "Design Packs",
  "license": "¬© Design Packs. All rights reserved. This code is protected by copyright law and may not be reproduced, distributed, or used without explicit permission from the author. Shopify complies with the Digital Millennium Copyright Act (DMCA) and responds to claims of copyright infringement using DMCA procedures, which could result in the termination of your Shopify account.",
}
{%- endcomment -%}

{% comment %} Security Code - hides section when app uninstalled {% endcomment %}
{%- unless content_for_header contains 'design_packs_file.js' -%}
  {%- if request.design_mode -%}
    <div class="dsgn-pck__no-app-warning">
      <div class="dsgn-pck__no-app-warning-background">
      </div>
      <div class="dsgn-pck__no-app-warning-text dsgn-pck__rte">
        <p><strong>WARNING!</strong> This premium section will not display properly without an active subscription for <a href="https://apps.shopify.com/design-packs" target="_blank" rel="noopener nofollow">Design Packs</a>. If you need any support please email <a href="mailto:info@design-packs.com" target="_blank" rel="noopener">info@design-packs.com</a> with your questions.</p>
      </div>
    </div>
  {%- endif -%}
  {%- break -%}
{%- endunless -%}

{%- comment -%} Assign: Preview section js fix {%- endcomment -%}
{%- assign section_id = section.id | replace: '+', '' | replace: '=', '' -%}

{%- comment -%} Color: check if color is set to transparent {%- endcomment -%}
{%- assign button_alpha = section.settings.button_background_color | color_extract: 'alpha' -%}

{%- comment -%} Layout: has user entered measurement value into max-width field? {%- endcomment -%}
{%- if section.settings.max_width contains 'px' or section.settings.max_width contains '%' -%}
  {%- assign max_width = section.settings.max_width -%}
{%- else -%}
  {%- assign max_width = section.settings.max_width | append: 'px' -%}
{%- endif -%}

{%- comment -%} Text: custom font_picker values {%- endcomment -%}
{%- capture font_settings_list -%}
{{ section.settings.main_font | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'style', 'italic' | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'style', 'italic' | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'style', 'italic' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'style', 'italic' | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}
{%- endcapture -%}
{%- assign font_array = font_settings_list | split: '~' -%}

{%- capture minify -%}
{%- comment -%} CSS {%- endcomment -%}
<style>
{%- if section.settings.override_theme_font != blank -%}
  {%- for font in font_array -%}
    {%- unless font contains 'error' -%}{{ font }}{%- endunless -%}
  {%- endfor -%}
  .DP--{{ section_id }} {
    --main-font: {{ section.settings.main_font.family }}, {{ section.settings.main_font.fallback_families }};
    --main-font-weight: {{ section.settings.main_font.weight }};
    --main-font-style: {{ section.settings.main_font.style }};
    --heading-font: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
    --heading-font-weight: {{ section.settings.heading_font.weight }};
    --heading-font-style: {{ section.settings.heading_font.style }};
  }
{%- endif -%}

.DP--{{ section_id }} {
  margin-bottom: {{ section.settings.outer_margin }}px;
  margin-top: {{ section.settings.outer_margin }}px;
}

.DP--{{ section_id }} .dsgn-pck__sizer {
  padding-top: {{ section.settings.inner_padding }}px;
  padding-bottom: {{ section.settings.inner_padding }}px;
  width: {{ section.settings.base_width }}%;
  max-width: {{ max_width }};
}

.DP--{{ section_id }} .dsgn-pck__small-heading {
  margin: 0;
  line-height: var(--dp-g-small-heading-line-height, var(--dp-small-heading-line-height, calc(3px + 2ex + 3px)));
  color: {{ section.settings.heading_color }};
  font-size: calc(var(--dp-g-small-heading-size, var(--dp-small-heading-size, 24px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--heading-font);
  font-weight: var(--heading-font-weight);
  font-style: var(--heading-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__comments {
  margin: 20px 0;
  padding: 0;
}

.DP--{{ section_id }} .dsgn-pck__comment {
  list-style: none;
  border-top: solid 1px {{ section.settings.border_color }};
  border-bottom: solid 1px {{ section.settings.border_color }};
  padding: 20px 0;
}

.DP--{{ section_id }} .dsgn-pck__meta {
  margin-top: 20px;
  text-align: right;
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2ex + 3px)));
  color: {{ section.settings.text_color }};
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.008 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__text,
.DP--{{ section_id }} p,
.DP--{{ section_id }} .dsgn-pck__grid__item label,
.DP--{{ section_id }} .dsgn-pck__form-message__link {
  text-decoration: none;
  font-weight: normal;
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2ex + 3px)));
  color: {{ section.settings.text_color }};
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__fine-print {
  display: block;
  width: 100%;
}

.DP--{{ section_id }} .dsgn-pck__button {
  display: inline-block;
  text-decoration: none;
  padding: var(--dp-button-padding, 0.5em 1.2em);
  border: thin solid;
  transition: all 0.3s;
  border-radius: {{ section.settings.button_radius }}px;
  line-height: var(--dp-g-button-line-height, var(--dp-button-line-height, calc(3px + 2ex + 3px)));
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  color: {{ section.settings.button_label_color }};
  border-color: {%- if button_alpha != 0 -%}{{ section.settings.button_background_color }}{%- else -%}{{ section.settings.button_label_color }}{%- endif -%};
  background-color: {{ section.settings.button_background_color }};
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__button:hover {
  {%- if button_alpha != 0 -%}
  background-color: {{ section.settings.button_background_color | color_modify: 'alpha', 0.8 }};
  border-color: transparent;
  {%- else -%}
  background-color: {{ section.settings.button_label_color | color_modify: 'alpha', 0.1 }}
  {%- endif -%};
}

.DP--{{ section_id }} .dsgn-pck__grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  width: 100%;
  gap: 20px;
  margin: 20px 0;
}

.DP--{{ section_id }} .dsgn-pck__grid__item input {
  width: 100%;
  padding: 10px;
  border: 1px solid {{ section.settings.border_color }};
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2ex + 3px)));
  color: {{ section.settings.text_color }};
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__grid__item textarea {
  width: 100%;
  min-height: 150px;
  padding: 10px;
  border: 1px solid {{ section.settings.border_color }};
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2ex + 3px)));
  color: {{ section.settings.text_color }};
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__grid__item--full {
  grid-column: 1/-1;
}

.DP--{{ section_id }} .dsgn-pck__pagination {
  text-align: center;
  margin-top: 1.5rem;
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__pagination .page {
  padding: 0.5em 1em;
  margin: 0 auto;
  transition: 0.3s;
  display: inline-block;
  border: 1px solid transparent;
}

.DP--{{ section_id }} .dsgn-pck__pagination .page:hover {
  border: 1px solid;
  font-style: italic;
}

.DP--{{ section_id }} .dsgn-pck__pagination .prev,
.DP--{{ section_id }} .dsgn-pck__pagination .next {
  padding: 1em;
}

.DP--{{ section_id }} .dsgn-pck__pagination .prev a,
.DP--{{ section_id }} .dsgn-pck__pagination .next a,
.DP--{{ section_id }} .dsgn-pck__pagination .page a {
  text-decoration: none;
  color: {{ section.settings.text_color }};
}

.DP--{{ section_id }} .dsgn-pck__pagination .current {
  border: 1px solid;
  font-style: italic;
}

/* Landscape phones and down */
@media (max-width: 480px) {
  .DP--{{ section_id }} .dsgn-pck__sizer {
    min-width: 70%;
    padding-top: {{ section.settings.inner_padding | divided_by: 2 }}px;
    padding-bottom: {{ section.settings.inner_padding | divided_by: 2 }}px;
  }

  {%- if section.settings.mobile_custom_css != blank -%}
    {%- assign mobile_custom_declarations = section.settings.mobile_custom_css | split: '}' -%}
    {%- for declaration in mobile_custom_declarations -%}
      {%- if declaration contains '{' -%}
        #DP--{{ section_id }} {{ declaration }} }
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}
}
</style>

{%- comment -%} HTML {%- endcomment -%}
<section id="DP--{{ section_id }}" class="DP--{{ section_id }} dsgn-pck__article-comments dsgn-pck__section">
  {%- if section.settings.anchor_id != blank -%}
    <div id="{{ section.settings.anchor_id | remove: '#' | handleize }}" class="dsgn-pck__anchor-id" style="height: 0; overflow: hidden;"></div>
  {%- endif -%}
  <div class="dsgn-pck__sizer">
    {%- if comment.status == 'pending' -%}
      {%- assign number_of_comments = article.comments_count | plus: 1 -%}
    {%- else -%}
      {%- assign number_of_comments = article.comments_count -%}
    {%- endif -%}
    {% if blog.comments_enabled? %}
      {% if number_of_comments > 0 %}
          <h3 data-no-toc class="dsgn-pck__small-heading">{{ number_of_comments }} Comment{%- if number_of_comments > 1 -%}s{%- endif -%}</h3>

          {% paginate article.comments by 5 %}

            {% comment %}
              #comments is required, it is used as an anchor link by Shopify.
            {% endcomment %}
            <div id="dsgn-pck__comments">
              <ul class="dsgn-pck__comments">
                {% comment %}
                  If a comment was just submitted with no blank field, show it.
                {% endcomment %}
                {% if comment.status == 'pending' %}
                  <li id="{{ comment.id }}" class="dsgn-pck__comment">
                    <div class="dsgn-pck__text dsgn-pck__rte">
                      {{ comment.content }}
                    </div>
                    <div class="dsgn-pck__meta">
                      <span class="dsgn-pck__meta-item">{{ comment.author }}</span>
                      ‚Ä¢
                      <span class="dsgn-pck__meta-item">{{ comment.created_at | time_tag: format: 'date' }}</span>
                    </div>
                  </li>
                {% endif %}

                {% for comment in article.comments %}
                  <li id="{{ comment.id }}" class="dsgn-pck__comment">
                    <div class="dsgn-pck__text dsgn-pck__rte">
                      {{ comment.content }}
                    </div>
                    <div class="dsgn-pck__meta">
                      <span class="dsgn-pck__meta-item">{{ comment.author }}</span>
                      ‚Ä¢
                      <span class="dsgn-pck__meta-item">{{ comment.created_at | time_tag: format: 'date' }}</span>
                    </div>
                  </li>
                {% endfor %}
              </ul>

                {% if paginate.pages > 1 %}
                  <div class="dsgn-pck__pagination">
                    {{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}
                  </div>
                {% endif %}

            </div>
          {% endpaginate %}
      {% endif %}

      <div class="dsgn-pck__form-wrapper">
        <div class="dsgn-pck__form">
          <div class="dsgn-pck__comment-form">
            {% form 'new_comment', article %}

              {%- assign formId = 'CommentForm' -%}

              <h3 class="dsgn-pck__small-heading">{{ 'comments_title' | t }}</h3>

              {%- assign post_message = 'blogs.comments.success' -%}
              {%- if blog.moderated? and comment.status == 'pending' -%}
                {%- assign post_message = 'blogs.comments.success_moderated' -%}
              {%- elsif comment.status == 'unapproved' or comment.status == 'spam' -%}
                {%- assign post_message = 'blogs.comments.unapproved' -%}
              {%- endif -%}

              {%- if form.posted_successfully? -%}
                <p class="dsgn-pck__form-message dsgn-pck__form-message--success" tabindex="-1" data-form-status>
                  {{ success_message | default: 'post_success' | t }}
                </p>
              {%- endif -%}

              {% comment %} We need to add this so the errors are output in the right order {% endcomment %}
              {% assign error_order = "author, email, body, password, form" | split: ", " %}

              {%- if form.errors -%}

                {%- if form.errors.translated_fields.size == 1 and form.errors.first == 'form' -%}
                  <p class="dsgn-pck__form-message" tabindex="-1" data-form-status>
                    {{ form.errors.messages['form'] }}
                  </p>

                {% else %}
                  <div class="dsgn-pck__form-message dsgn-pck__form-message--error">
                    <h2 class="dgn-pck__small-heading" tabindex="-1" data-form-status>{{ 'error_heading' | t }}</h2>

                    <ul>
                      {% for error in error_order %}
                        {% for field in form.errors %}
                          {% if error == field %}

                            {% capture field_label %}
                              {% case field %}
                                {% when 'author' %}
                                  {{ 'contact_form_name' | t }}
                                {% when 'body' %}
                                  {{ 'contact_form_message' | t }}
                                {% else %}
                                  {{ form.errors.translated_fields[field] }}
                              {% endcase %}
                            {% endcapture %}
                            <li>
                              {%- if field == 'form' -%}
                                {{ form.errors.messages[field] }}
                              {%- else -%}
                                {% comment %} the href should match the input's id {% endcomment %}
                                <a href="#{{ form_id }}-{{ field }}" class="dsgn-pck__form-message__link">{{ field_label | strip | capitalize }} {{ form.errors.messages[field] }}</a>
                              {%- endif -%}
                            </li>
                          {% endif %}
                        {% endfor %}
                      {% endfor %}
                    </ul>
                  </div>
                {%- endif -%}
              {%- endif -%}

              <div class="dsgn-pck__grid">

                <div class="dsgn-pck__grid__item">
                  <label for="{{ formId }}-author">{{ 'blogs_comments_name' | t }}</label>
                  <input type="text" name="comment[author]" id="{{ formId }}-author" class="dsgn-pck__input-full{% if form.errors contains 'author' %} dsgn-pck__input--error{% endif %}" value="{{ form.author }}"{% if form.errors contains 'author' %} aria-invalid="true" aria-describedby="{{ formId}}-author-error"{% endif %}>
                  {% if form.errors contains 'author' %}
                    <span id="{{ formId }}-author-error" class="dsgn-pck__input-error-message">
                      <span class="dsgn-pck__visually-hidden">{{ 'error' | t }} </span>
                      <span>{{ 'blogs_comments_name' | t }} {{ form.errors.messages['author'] }}.</span>
                    </span>
                  {% endif %}
                </div>

                <div class="dsgn-pck__grid__item">
                  <label for="{{ formId }}-email">{{ 'blogs_comments_email' | t }}</label>
                  <input type="email" name="comment[email]" id="{{ formId }}-email" class="dsgn-pck__input-full{% if form.errors contains 'email' %} dsgn-pck__input--error{% endif %}" value="{{ form.email }}" autocorrect="off" autocapitalize="off" {% if form.errors contains 'email' %} aria-invalid="true" aria-describedby="{{ formId}}-email-error"{% endif %}>
                  {% if form.errors contains 'email' %}
                    <span id="{{ formId }}-email-error" class="dsgn-pck__input-error-message">
                      <span class="dsgn-pck__visually-hidden">{{ 'error' | t }} </span>
                      <span>{{ form.errors.translated_fields['email'] | capitalize }} {{ form.errors.messages['email'] }}.</span>
                    </span>
                  {% endif %}
                </div>

                <div class="dsgn-pck__grid__item dsgn-pck__grid__item--full">
                  <label for="{{ formId }}-body">{{ 'blogs_comments_message' | t }}</label>
                  <textarea name="comment[body]" id="{{ formId }}-body" class="dsgn-pck__input-full{% if form.errors contains 'body' %} dsgn-pck__input--error{% endif %}"{% if form.errors contains 'body' %} aria-invalid="true" aria-describedby="{{ formId}}-body-error"{% endif %}>{{ form.body }}</textarea>
                  {% if form.errors contains 'body' %}
                    <span id="{{ formId }}-body-error" class="dsgn-pck__input-error-message">
                      <span class="dsgn-pck__visually-hidden">{{ 'error' | t }} </span>
                      <span>{{ 'blogs_comments_message' | t }} {{ form.errors.messages['body'] }}.</span>
                    </span>
                  {% endif %}
                </div>

              </div>

              {% if blog.moderated? %}
                <p class="dsgn-pck__fine-print">{{ 'blogs_comments_moderated' | t }}</p>
              {% endif %}

              <input type="submit" class="btn dsgn-pck__button" value="{{ 'blogs_comments_post' | t }}">
            {% endform %}
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</section>
{%- endcapture -%}
{{ minify | strip_newlines }}

{% schema %}
{
  "name": "Article comments",
  "class": "DP__article-comments DP__shift",
  "limit": 1,
  "enabled_on": {
    "templates": ["article"]
  },
  "settings": [
    {
      "type": "header",
      "content": "‚úèÔ∏è Text appearance"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 80,
      "max": 150,
      "step": 5,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "header",
      "content": "üé® Design"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Headings",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Borders",
      "default": "#CFCFCF"
    },
    {
      "type": "color",
      "id": "button_label_color",
      "label": "Button label",
      "default": "#4B4949"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background",
      "default": "rgba(0,0,0,0)"
    },
    {
      "type": "range",
      "id": "button_radius",
      "label": "Button border radius",
      "min": 0,
      "max": 50,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "üñº Layout"
    },
    {
      "type": "range",
      "id": "base_width",
      "label": "Size",
      "min": 50,
      "max": 100,
      "step": 5,
      "default": 80,
      "unit": "%"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Maximum width",
      "placeholder": "eg. 1200px",
      "info": "Sets width constraint for content."
    },
    {
      "type": "range",
      "id": "inner_padding",
      "label": "Inner padding",
      "info": "Only applies to top and bottom.",
      "min": 0,
      "max": 100,
      "default": 40,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "üö® Advanced"
    },
    {
      "type": "liquid",
      "id": "custom_css",
      "label": "CSS"
    },
    {
      "type": "liquid",
      "id": "mobile_custom_css",
      "label": "Mobile CSS",
      "info": "Applied on screens less than 480px."
    },
    {
      "type": "text",
      "id": "anchor_id",
      "label": "Link anchor id",
      "placeholder": "#design-pack-section",
      "info": "Enter a unique value to jump to this section from same page using a link or button. Eg. #design-pack-section [Learn more](https://app.gitbook.com/o/UwqKbTxsdQExehd4SSPM/s/iJpf70jLagzGk8zoz4fu/fundamentals/how-to-guides/how-to-jump-link-to-another-section-on-the-same-page)"
    },
    {
      "type": "checkbox",
      "id": "override_theme_font",
      "label": "Override default theme font",
      "default": false
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Headings",
      "default": "serif"
    },
    {
      "type": "font_picker",
      "id": "main_font",
      "label": "Text",
      "default": "sans-serif"
    }
  ],
  "locales": {
    "en": {
      "comments_title": "Leave a comment",
      "post_success": "Your comment was successfully submitted! Thank you!",
      "error_heading": "Please adjust the following:",
      "error": "Error in field",
      "contact_form_name": "Name",
      "contact_form_message": "Message",
      "blogs_comments_name": "Name",
      "blogs_comments_email": "Email",
      "blogs_comments_message": "Message",
      "blogs_comments_moderated": "Please note, comments must be approved before they are published",
      "blogs_comments_post": "Post comment"
    }
  },
  "presets": [
    {
      "name": "Article comments üéí",
      "settings": {
        "text_size": 100,
        "heading_color": "#121212",
        "text_color": "#121212",
        "border_color": "#121212",
        "button_label_color": "#ffffff",
        "button_background_color": "#121212",
        "button_radius": 0,
        "base_width": 90,
        "max_width": "",
        "inner_padding": 80,
        "custom_css": "",
        "mobile_custom_css": "",
        "override_theme_font": false,
        "heading_font": "serif",
        "main_font": "sans-serif"
      }
    }
  ]
}
{% endschema %}
