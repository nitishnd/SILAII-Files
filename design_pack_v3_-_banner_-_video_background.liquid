{%- comment -%}
{
  "pack_name": "Banner - video background",
  "pack_author": "Design Packs",
  "license": "¬© Design Packs. All rights reserved. This code is protected by copyright law and may not be reproduced, distributed, or used without explicit permission from the author. Shopify complies with the Digital Millennium Copyright Act (DMCA) and responds to claims of copyright infringement using DMCA procedures, which could result in the termination of your Shopify account.",
}
{%- endcomment -%}

{% comment %} Security Code - hides section when app uninstalled {% endcomment %}
{%- unless content_for_header contains 'design_packs_file.js' -%}
  {%- if request.design_mode -%}
    <div class="dsgn-pck__no-app-warning">
      <div class="dsgn-pck__no-app-warning-background">
      </div>
      <div class="dsgn-pck__no-app-warning-text dsgn-pck__rte">
        <p><strong>WARNING!</strong> This premium section will not display properly without an active subscription for <a href="https://apps.shopify.com/design-packs" target="_blank" rel="noopener nofollow">Design Packs</a>. If you need any support please email <a href="mailto:info@design-packs.com" target="_blank" rel="noopener">info@design-packs.com</a> with your questions.</p>
      </div>
    </div>
  {%- endif -%}
  {%- break -%}
{%- endunless -%}

{%- comment -%} Assign: Preview section js fix {%- endcomment -%}
{%- assign section_id = section.id | replace: '+', '' | replace: '=', '' -%}

{%- comment -%} Assign: detect if dynamic metadata content is present in section {%- endcomment -%}
{%- assign enable_metafield_detect = section.settings.enable_metafield_detect | default: false -%}

{%- comment -%} Images: all placeholders {%- endcomment -%}
{%- assign background_placeholder_video_id = '5f2ab401807b458383fb168fbc4e5b03' -%}

{%- comment -%} Images: check image crop aspect ratio {%- endcomment -%}
{%- if section.settings.image_crop == 'none' -%}
  {%- assign image_crop_width = section.settings.aspect_ratio | split: ':' | first | times: 1000 -%}
  {%- assign image_crop_height = section.settings.aspect_ratio | split: ':' | last | times: 1000 -%}
{%- else -%}
  {%- assign image_crop_width = section.settings.image_crop | split: ':' | first | times: 1000 -%}
  {%- assign image_crop_height = section.settings.image_crop | split: ':' | last | times: 1000 -%}
{%- endif -%}

{%- comment -%} Layout: has user entered measurement value into max-width field? {%- endcomment -%}
{%- if section.settings.max_width contains 'px' or section.settings.max_width contains '%' -%}
  {%- assign max_width = section.settings.max_width -%}
{%- else -%}
  {%- assign max_width = section.settings.max_width | append: 'px' -%}
{%- endif -%}

{%- comment -%} Layout: controls entire overall width {%- endcomment -%}
{%- if section.settings.max_base_width contains 'px' or section.settings.max_base_width contains '%' -%}
  {%- assign max_base_width = section.settings.max_base_width -%}
{%- else -%}
  {%- assign max_base_width = section.settings.max_width | append: 'px' -%}
{%- endif -%}

{% comment %} Metafields: hide section if there is no content {% endcomment %}
{%- if section.settings.video == blank and enable_metafield_detect == true -%}
  {%- break -%}
{%- endif -%}

{%- comment -%} Text: check text position {%- endcomment -%}
{%- assign horizontal_text_position = section.settings.text_position | split: ' ' | first -%}
{%- assign vertical_text_position = section.settings.text_position | split: ' ' | last -%}

{%- comment -%} Text: custom font_picker values {%- endcomment -%}
{%- capture font_settings_list -%}
{{ section.settings.main_font | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'style', 'italic' | font_face: font_display: 'swap' }}~
{{ section.settings.main_font | font_modify: 'style', 'italic' | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'style', 'italic' | font_face: font_display: 'swap' }}~
{{ section.settings.heading_font | font_modify: 'style', 'italic' | font_modify: 'weight', 'bolder' | font_face: font_display: 'swap' }}
{%- endcapture -%}
{%- assign font_array = font_settings_list | split: '~' -%}

{%- comment -%} CSS {%- endcomment -%}
<style>
{%- if section.settings.override_theme_font != blank -%}
  {%- for font in font_array -%}
    {%- unless font contains 'error' -%}{{ font }}{%- endunless -%}
  {%- endfor -%}
  .DP--{{ section_id }} {
    --main-font: {{ section.settings.main_font.family }}, {{ section.settings.main_font.fallback_families }};
    --main-font-weight: {{ section.settings.main_font.weight }};
    --main-font-style: {{ section.settings.main_font.style }};
    --heading-font: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
    --heading-font-weight: {{ section.settings.heading_font.weight }};
    --heading-font-style: {{ section.settings.heading_font.style }};
  }
{%- endif -%}

.DP--{{ section_id }} {
  margin-top: {{ section.settings.outer_margin_top }}px;
  margin-bottom: {{ section.settings.outer_margin_bottom }}px;
  margin-left: auto;
  margin-right: auto;
  width: {{ section.settings.base_width }}%;
  max-width: {{ max_base_width }};
}

.DP--{{ section_id }} .dsgn-pck__sizer {
  width: 90%;
  margin: auto;
  max-width: {{ max_width }};
}

.DP--{{ section_id }} .dsgn-pck__background {
  width: 100%;
}

.DP--{{ section_id }} .dsgn-pck__background-image::before {
  content: '';
  display: block;
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
  z-index: 1;
  background: {{ section.settings.image_overlay_color }};
}

.DP--{{ section_id }} .dsgn-pck__background-video {
  object-fit: cover;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100%;
  position: absolute;
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  -webkit-backface-visibility: hidden;
  -moz-backface-visibility: hidden;
  z-index: -1;
}

.DP--{{ section_id }} .dsgn-pck__background-video::-webkit-media-controls-panel {
  background-image: none !important;
  filter: brightness(0.4);
}

.DP--{{ section_id }} .dsgn-pck__grid--main {
  height: 100%;
}

.DP--{{ section_id }} .dsgn-pck__content {
  z-index: 2;
  height: 100%;
  grid-template-columns: 1fr;
  grid-area: 1 / 1 / 2 / 2;
  padding: 5% 0;
}

.DP--{{ section_id }} .dsgn-pck__inner-content {
  z-index: 2;
  max-width: {{ section.settings.text_width }}px;
  width: 100%;
  padding: {%- if section.settings.text_background_color != blank or section.settings.text_background_solid != blank -%}clamp(10px, 5%, 40px){%- endif -%};
  background: {%- if section.settings.text_background_color != blank -%}{{ section.settings.text_background_color }}{%- else -%}{{ section.settings.text_background_solid }}{%- endif -%};
  border-radius: {{ section.settings.text_background_radius }}px;
}

{% comment %} Block styling {% endcomment %}
.DP--{{ section_id }} .dsgn-pck__block .dsgn-pck__small-heading {
  font-size: calc(var(--dp-g-small-heading-size, var(--dp-small-heading-size, 24px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
    font-family: var(--heading-font);
    font-weight: var(--heading-font-weight);
    font-style: var(--heading-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__text p,
.DP--{{ section_id }} .dsgn-pck__text ul {
  line-height: var(--dp-g-body-line-height, var(--dp-body-line-height, calc(3px + 2.5ex + 3px)));
  color: {{ section.settings.text_color }};
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.01 }});
  {%- if section.settings.override_theme_font != blank -%}
  font-family: var(--main-font);
  font-weight: var(--main-font-weight);
  font-style: var(--main-font-style);
  {%- endif -%}
}

.DP--{{ section_id }} .dsgn-pck__small-text p,
.DP--{{ section_id }} .dsgn-pck__small-text ul {
  font-size: calc(var(--dp-g-body-size, var(--dp-body-size, 18px)) * {{ section.settings.text_size | times: 0.008 }});
}

{%- if section.settings.text_alignment == 'center' -%}
  .DP--{{ section_id }} .dsgn-pck__rte ul {
    display: table;
    margin: 0 auto;
    text-align: left;
  }
{%- elsif section.settings.text_alignment == 'right' -%}
  .DP--{{ section_id }} .dsgn-pck__rte ul {
    display: table;
    margin-left: auto;
    text-align: left;
  }
{%- endif -%}

.DP--{{ section_id }} .dsgn-pck__block {
  color: {{ section.settings.text_color }};
}

.DP--{{ section_id }} .dsgn-pck__block + .dsgn-pck__block {
  margin-top: 15px;
}
{% comment %} End block styling {% endcomment %}

/* Animation */
{%- if section.settings.animation != 'none' -%}
  #DP--{{ section_id }}.dsgn-pck__animation-applied [style*="--dsgn-pck-animate"] {
    animation-name: dsgn-pck__animation--{{ section.settings.animation }};
  }
{%- else -%}
  .DP--{{ section_id }} [style*="--dsgn-pck-animate"] {
    opacity: 1;
  }
{% endif %}

{%- if section.settings.custom_css != blank -%}
  {%- assign custom_section_declarations = section.settings.custom_css | split: '}' -%}
  {%- for declaration in custom_section_declarations -%}
    {%- if declaration contains '{' -%}
      #DP--{{ section_id }} {{ declaration }} }
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

/* Landscape phones and down */
@media (max-width: 767px) {
  .DP--{{ section_id }} {
    margin-top: {{ section.settings.outer_margin | times: 0.75 | round: 0 }}px;
    margin-bottom: {{ section.settings.outer_margin | times: 0.75 | round: 0 }}px;
  }

  .DP--{{ section_id }} .dsgn-pck__inner-content {
    min-width: 100%;
  }

  {%- if section.settings.mobile_aspect_ratio != blank -%}
    .DP--{{ section_id }} .dsgn-pck__background-image > .dsgn-pck__svg-sizer {
      aspect-ratio: {{ section.settings.mobile_aspect_ratio | replace: ':', ' / ' }};
    }
  {%- endif -%}

  {%- if section.settings.mobile_custom_css != blank -%}
    {%- assign mobile_custom_declarations = section.settings.mobile_custom_css | split: '}' -%}
    {%- for declaration in mobile_custom_declarations -%}
      {%- if declaration contains '{' -%}
        #DP--{{ section_id }} {{ declaration }} }
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}
}

  /* Hide or show on mobile and desktop */
  {%- if section.settings.hidden_on == 'mobile' -%}
    @media (max-width: 767px) {
      .DP--{{ section_id }} {
        display: none;
      }
    }
  {%- endif -%}

  {%- if section.settings.hidden_on == 'desktop' -%}
    @media (min-width: 768px) {
      .DP--{{ section_id }} {
        display: none;
      }
    }
  {%- endif -%}
</style>

{%- comment -%} HTML {%- endcomment -%}
<section id="DP--{{ section_id }}" class="DP--{{ section_id }} dsgn-pck__banner-video dsgn-pck__section {{ section.settings.custom_classes }} {% if section.settings.custom_style == 'scheme' -%}{{ section.settings.style_scheme }}{% elsif section.settings.custom_style == 'global' -%}dsgn-pck__global-style{% else -%}dsgn-pck__section-style{% endif %}">
  {%- if section.settings.anchor_id != blank -%}
    <div id="{{ section.settings.anchor_id | remove: '#' | handleize }}" class="dsgn-pck__anchor-id" style="height: 0; overflow: hidden;"></div>
  {%- endif -%}
  <div class="dsgn-pck__background">
    {%- if section.settings.link != blank -%}
      <a class="dsgn-pck__absolute-link" href="{{ section.settings.link }}">{{ section.settings.link.title }}</a>
    {% endif %}
    <div class="dsgn-pck__image__wrapper dsgn-pck__background-image">
      <svg class="dsgn-pck__svg-sizer" viewBox="0 0 {{ image_crop_width }} {{ image_crop_height }}"></svg>
      {%- assign video = section.settings.video -%}
      <video class="dsgn-pck__background-video dsgn-pck__video-element" width="{{ video.aspect_ratio | times: 100 }}" height="100" autoplay muted playsinline preload="none" loading="lazy" {% if section.settings.loop %}loop{% endif %} {% if video != blank %}poster="{{ video.preview_image | image_url: width: 2800 }}"{% endif %}>
        {% if video != blank %}
          {%- for source in video.sources -%}
            {%- if source.format == 'mp4' or source.format == 'mov' -%}<source data-src="{{ source.url }}" data-dsgn-pck-default-src>{%- endif -%}
          {%- endfor -%}
          {%- if section.settings.mobile_video != blank -%}
            {%- for mobile_source in section.settings.mobile_video.sources -%}
              {%- if mobile_source.format == 'mp4' or mobile_source.format == 'mov' -%}<source data-src="{{ mobile_source.url }}" data-dsgn-pck-mobile-src>{%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        {%- else -%}
          <source data-src="https://cdn.shopify.com/videos/c/o/v/{{ background_placeholder_video_id }}.mp4" data-dsgn-pck-default-src>
        {%- endif -%}
      </video>
      <div class="dsgn-pck__sizer dsgn-pck__grid dsgn-pck__grid--main">
        <div class="dsgn-pck__content
                    dsgn-pck__flex dsgn-pck__justify-{{ horizontal_text_position }}
                    dsgn-pck__align-{{ vertical_text_position }}
                    dsgn-pck__text-alignment-{{ section.settings.text_alignment }}">
          {%- if section.settings.link != blank -%}
            <a class="dsgn-pck__absolute-link" href="{{ section.settings.link }}">{{ section.settings.background_image.alt }}</a>
          {%- endif -%}
          {%- if section.blocks.size > 0 -%}
            <div class="dsgn-pck__inner-content dsgn-pck__relative">
              {%- content_for 'blocks' -%}
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Banner - video background",
  "class": "DP__banner-video-background DP__AI-enabled",
  "blocks": [
    {
      "type": "@theme",
    },
    {
      "type": "@app",
    },
    {
      "type": "dpb_-_heading"
    },
    {
      "type": "dpb_-_button-group"
    },
    {
      "type": "dpb_-_inset_image"
    },
    {
      "type": "dpb_-_video"
    },
    {
      "type": "dpb_-_icons"
    },
    {
      "type": "dpb_-_text"
    },
    {
      "type": "dpb_-_divider"
    },
    {
      "type": "dpb_-_spacer"
    },
    {
      "type": "_dpb_-_columns"
    },
    {
      "type": "_dpb_-_group"
    }
  ],
  "settings": [
    {
      "type": "video",
      "id": "video",
      "label": "Video",
      "info": "Upload your video file here. Does not support YouTube videos or Vimeo videos."
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop video",
      "default": true
    },
    {
      "type": "select",
      "id": "image_crop",
      "label": "Banner height",
      "default": "1200:600",
      "options": [
        {
          "label": "Defined aspect ratio (see below)",
          "value": "none"
        },
        {
          "label": "Extra small",
          "value": "1200:200"
        },
        {
          "label": "Small",
          "value": "1200:400"
        },
        {
          "label": "Medium",
          "value": "1200:600"
        },
        {
          "label": "Large",
          "value": "1200:800"
        },
        {
          "label": "Extra large",
          "value": "1200:1000"
        }
      ]
    },
    {
      "type": "text",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "16:9",
      "info": "eg. 16:9, 4:3. Will only be applied if 'Defined aspect ratio' is selected as banner height."
    },
    {
      "type": "url",
      "id": "link",
      "label": "Link",
      "info": "Links entire video."
    },
    {
      "type": "header",
      "content": "üì± Mobile"
    },
    {
      "type": "video",
      "id": "mobile_video",
      "label": "Mobile video (optional)"
    },
    {
      "type": "text",
      "id": "mobile_aspect_ratio",
      "label": "Mobile aspect ratio",
      "info": "Set specific aspect ratio for smaller screensizes - eg. 1:1."
    },
    {
      "type": "header",
      "content": "‚úèÔ∏è Content"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 80,
      "max": 150,
      "step": 5,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Horizontal alignment",
      "default": "center",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ]
    },
    {
      "type": "select",
      "id": "text_position",
      "label": "Content position",
      "default": "center center",
      "options": [
        {
          "value": "left top",
          "label": "Top left"
        },
        {
          "value": "center top",
          "label": "Top center"
        },
        {
          "value": "right top",
          "label": "Top right"
        },
        {
          "value": "left center",
          "label": "Left"
        },
        {
          "value": "center center",
          "label": "Center"
        },
        {
          "value": "right center",
          "label": "Right"
        },
        {
          "value": "left bottom",
          "label": "Bottom left"
        },
        {
          "value": "center bottom",
          "label": "Bottom center"
        },
        {
          "value": "right bottom",
          "label": "Bottom right"
        }
      ]
    },
    {
      "type": "range",
      "id": "text_width",
      "label": "Content box max width",
      "min": 400,
      "max": 1500,
      "step": 20,
      "default": 600,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "üé® Design"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "text_background_solid",
      "label": "Content box background",
      "alpha": true
    },
    {
      "type": "color_background",
      "id": "text_background_color",
      "label": "Content box background gradient",
      "info": "Background gradient replaces content box background where possible."
    },
    {
      "type": "range",
      "id": "text_background_radius",
      "label": "Content box rounded corners",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "color_background",
      "id": "image_overlay_color",
      "label": "Video overlay",
      "default": "radial-gradient(rgba(255, 255, 255, 0.4), rgba(0, 0, 0, 0.4) 100%)"
    },
    {
      "type": "header",
      "content": "üé¨ Animation"
    },
    {
      "type": "select",
      "id": "animation",
      "label": "Animation",
      "default": "none",
      "options": [
        {
          "value": "fade-in",
          "label": "Fade-in"
        },
        {
          "value": "fade-in-left",
          "label": "Fade-in left"
        },
        {
          "value": "fade-in-right",
          "label": "Fade-in right"
        },
        {
          "value": "fade-in-up",
          "label": "Fade-in up"
        },
        {
          "value": "fade-in-down",
          "label": "Fade-in down"
        },
        {
          "value": "none",
          "label": "None"
        }
      ]
    },
    {
      "type": "header",
      "content": "üñº Layout"
    },
    {
      "type": "range",
      "id": "base_width",
      "label": "Size",
      "min": 80,
      "max": 100,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "text",
      "id": "max_base_width",
      "label": "Maximum width",
      "placeholder": "eg. 1200px",
      "info": "Sets width constraint for entire section."
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Maximum inner width",
      "placeholder": "eg. 1200px",
      "info": "Prevents inner content from moving too far to the edge on large screens."
    },
    {
      "type": "range",
      "id": "outer_margin_top",
      "label": "Outer margin - top",
      "min": 0,
      "max": 100,
      "default": 0,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "outer_margin_bottom",
      "label": "Outer margin - bottom",
      "min": 0,
      "max": 100,
      "default": 0,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "hidden_on",
      "label": "Hidden on",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "desktop",
          "label": "Desktop"
        },
        {
          "value": "mobile",
          "label": "Mobile"
        }
      ]
    },
    {
      "type": "header",
      "content": "üö® Advanced"
    },
    {
      "type": "liquid",
      "id": "custom_css",
      "label": "CSS"
    },
    {
      "type": "liquid",
      "id": "mobile_custom_css",
      "label": "Mobile CSS",
      "info": "Applied on screens less than 767px."
    },
    {
      "type": "text",
      "id": "anchor_id",
      "label": "Link anchor id",
      "placeholder": "#design-pack-section",
      "info": "Enter a unique value to jump to this section from same page using a link or button. Eg. #design-pack-section [Learn more](https://app.gitbook.com/o/UwqKbTxsdQExehd4SSPM/s/iJpf70jLagzGk8zoz4fu/fundamentals/how-to-guides/how-to-jump-link-to-another-section-on-the-same-page)"
    },
    {
      "type": "text",
      "id": "custom_classes",
      "label": "Custom classes",
      "placeholder": "my-custom-class my-custom-class--2",
      "info": "Add your own CSS classes to section. Eg. my-custom-class my-custom-class--2 [Learn more](https://design-packs.gitbook.io/docs/fundamentals/settings/custom-classes-setting)"
    },
    {
      "visible_if": "{{ false }}",
      "type": "select",
      "id": "custom_style",
      "label": "Custom style*",
      "info": "* Custom styles section is required. [Learn more](https://design-packs.gitbook.io/docs/fundamentals/settings/apply-global-styles-setting)",
      "options": [
        {
          "value": "section",
          "label": "Default section settings"
          },
        {
          "value": "scheme",
          "label": "Apply scheme"
        },
        {
          "value": "global",
          "label": "Inherit global style"
        }
      ],
      "default": "global"
    },
    {
      "visible_if": "{{ section.settings.custom_style == 'scheme' }}",
      "type": "text",
      "id": "style_scheme",
      "label": "Style scheme name"
    },
    {
      "type": "checkbox",
      "id": "override_theme_font",
      "label": "Override default theme font",
      "default": false
    },
    {
      "visible_if": "{{ section.settings.override_theme_font }}",
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading",
      "default": "serif"
    },
    {
      "visible_if": "{{ section.settings.override_theme_font }}",
      "type": "font_picker",
      "id": "main_font",
      "label": "Text",
      "default": "sans-serif"
    },
    {
      "type": "checkbox",
      "id": "enable_metafield_detect",
      "label": "Enable metafield detection",
      "default": false,
      "info": "Hide section if content is not detected. [Learn more](https://design-packs.gitbook.io/docs/fundamentals/settings/enable-metafield-detection-setting)"
    }
  ],
  "presets": [
    {
      "name": "Banner - video background üéí",
      "category": "* Design Packs * Hero Banners",
      "blocks": {
        "image": {
          "type": "dpb_-_inset_image",
          "name": "Image üéí"
        },
        "heading": {
          "type": "dpb_-_heading",
          "name": "Heading üéí"
        },
        "text": {
          "type": "dpb_-_text",
          "name": "Text üéí"
        },
        "button": {
          "type": "dpb_-_button-group",
          "name": "Buttons üéí"
        }
      },
      "block_order": [
        "image",
        "heading",
        "text",
        "button"
      ]
    }
  ]
}
{% endschema %}

  {%- comment -%} JSON Settings {%- endcomment -%}
<script type="application/json" data-dsgn-pck="{{ section_id }}">
  {
    "id": {{ section_id | json }},
    "animation": {{ section.settings.animation | json }},
    "hidden_on": {{ section.settings.hidden_on | json }}
  }
</script>
{%- comment -%} JavaScript {%- endcomment -%}
<script data-dsgn-pck-js="{{ section_id }}" type="module" defer>
(function(){

  const designPack = {
    settings: {},
    onIntersect: function(entries, observer){
      // Target the first entry available.
      let observedSection = entries[0];
      if (!observedSection.isIntersecting) return;
      const section = observedSection.target;

      /* Run these functions when section is visible */
      designPack.enableLazyVideoAutoplay(section);
      designPack.animateSection(section);

      /* Stop observing section */
      observer.unobserve(section);
    },
    animateSection: function(section){
      section.classList.add('dsgn-pck__animation-applied');
    },
    enableLazyVideoAutoplay: function(section) {

      // Get video source urls
      const lazySources = section.querySelectorAll('.dsgn-pck__video-element source[data-src]');
      lazySources.forEach(source => {
        if (!source.src){
          source.src = source.dataset.src;
        }
      });

      const lazyVideos = section.querySelectorAll('.dsgn-pck__video-element');
      lazyVideos.forEach((video, idx) => {
        // processing each video
        video.preload = 'auto';
        video.muted   = true;  // ensure property-level mute
        video.autoplay = true; // let browser decide
        video.load();

        // removed playing listener
        video.addEventListener('pause', () => {
          if (!video.ended) {
            video.play().catch(() => {});
          }
        });
        // After a short delay, if video is still paused, allow user interaction to start it (for Safari).
        setTimeout(() => {
          if (video.paused) {
            // autoplay failed ‚Äì awaiting user interaction
            const playOnInteract = () => {
              video.play().catch(()=>{});
              document.removeEventListener('click', playOnInteract);
              document.removeEventListener('touchstart', playOnInteract);
              document.removeEventListener('keydown', playOnInteract, { once: true });
            };
            document.addEventListener('click', playOnInteract);
            document.addEventListener('touchstart', playOnInteract);
            document.addEventListener('keydown', playOnInteract, { once: true });
          }
        }, 1500);
      });
    },
    swapVideoSource: function(mq, mobileSrc, section){

      const hiddenOn = designPack.settings.hidden_on;
      if (hiddenOn == 'mobile' && mq.matches){
        return;
      }
      if (hiddenOn == 'desktop' && !mq.matches){
        return;
      }

      const videoElement = section.querySelector(':not(.dsgn-pck__content) video');
      const defaultSrcEl = videoElement.querySelector('[data-dsgn-pck-default-src]');
      const defaultUrl = defaultSrcEl.src || defaultSrcEl.dataset.src;
      const mobileUrl = mobileSrc.src || mobileSrc.dataset.src;
      if (mq.matches){
        videoElement.src = mobileUrl;
      } else {
        videoElement.src = defaultUrl;
      }
    },
    load: function(section){

      const videoElement = section.querySelector('video');

      document.addEventListener('touchstart', function () {
        if (!videoElement.playing) {
          videoElement.play();
        }
      });

      const mobileSrc = section.querySelector('[data-dsgn-pck-mobile-src]');
      if (typeof mobileSrc !== 'undefined' && mobileSrc !== null){
        const mq = window.matchMedia('(max-width: 767px)');
        if (mq.matches) {
          designPack.swapVideoSource(mq, mobileSrc, section);
        }
        mq.addEventListener('change', function () {
          designPack.swapVideoSource(mq, mobileSrc, section);
        });
      }

      const options = {
        root: null,
        rootMargin: '0px',
        threshold: [0, 0.25, 0.5, 0.75, 1]
      };

      // Trigger functions when section is visible
      const observer = new IntersectionObserver( designPack.onIntersect, options );

      if (section) {
        observer.observe(section);
      }
    },
    unload: function(section){
      section.classList.remove('dsgn-pck__animation-applied')
    }
  }

  window.addEventListener('shopify:section:unload', function (e) {
    const settings = document.querySelector(`[data-dsgn-pck="${e.detail.sectionId}"]`);
    const sectionId = e.detail.sectionId;
    const section = document.querySelector(`#DP--${e.detail.sectionId}`);
    if (sectionId == designPack.settings.id){
      designPack.unload(section);
    }
  });

  designPack.settings = JSON.parse(document.querySelector('[data-dsgn-pck="{{ section_id }}"]').innerHTML);
  const sectionId = {{ section_id | json }};
  const section = document.querySelector(`#DP--${sectionId}`);

  if (sectionId == designPack.settings.id){
    designPack.load(section);
  }
})()
</script>
